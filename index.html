<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Premium Vertical Digital Signage</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }

        body {
            font-family: 'Montserrat', sans-serif;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* 9:16 Aspect Ratio Container for Vertical Display */
        .aspect-ratio-container {
            position: relative;
            width: 100vw;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #000;
        }

        /* Main Grid Layout - Maintains 9:16 vertical aspect ratio */
        .signage-container {
            position: relative;
            width: 100%;
            height: 100%;
            max-width: 56.25vh; /* 9:16 ratio based on height (9/16 * 100vh) */
            max-height: 177.78vw; /* 16:9 ratio based on width (16/9 * 100vw) */
            display: grid;
            grid-template-rows: 14vh 79vh 7vh;
            overflow: hidden;
            background: #000;
        }

        /* Zone 1: Top Bar - Strict 50:50 Grid Layout */
        .top-bar {
            background: linear-gradient(135deg, #001D56 0%, #002775 100%);
            display: grid;
            grid-template-columns: 50fr 50fr;
            align-items: center;
            padding: 2vh 3vh;
            border-bottom: 0.5vh solid #C4682D;
            height: 14vh;
            box-sizing: border-box;
            overflow: hidden;
        }

        /* Left Side: Bangkok Info */
        .location-info {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.5vh;
            height: 100%;
        }

        .city-name {
            font-size: 3vh;
            font-weight: 700;
            color: #fff;
            letter-spacing: 0.1vh;
            line-height: 1.2;
        }

        .time-weather-row {
            display: flex;
            align-items: center;
            gap: 2vh;
        }

        .local-time {
            font-size: 2.2vh;
            font-weight: 600;
            color: #C4682D;
            line-height: 1.2;
        }

        .local-date {
            font-size: 1.4vh;
            color: #ccc;
            line-height: 1.2;
        }

        .weather-info {
            display: flex;
            align-items: center;
            gap: 0.8vh;
            font-size: 1.4vh;
            color: #fff;
            line-height: 1.2;
        }

        .weather-icon {
            font-size: 4vh;
            line-height: 1;
        }

        .weather-temp {
            font-weight: 700;
            font-size: 2.2vh;
            color: #C4682D;
        }

        /* Right Side: World Clocks - 3 Equal Columns */
        .world-clocks {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            height: 100%;
            width: 100%;
            gap: 1vh;
        }

        /* Each Clock Column: auto (name) + 1fr (clock) */
        .clock-wrapper {
            display: grid;
            grid-template-rows: auto 1fr;
            height: 100%;
            justify-items: center;
            gap: 0.5vh;
        }

        /* City Name: Top Row */
        .clock-city {
            font-size: 1.6vh;
            font-weight: 600;
            color: #C4682D;
            white-space: nowrap;
            align-self: start;
            line-height: 1;
        }

        /* Analog Clock: Bottom Row */
        .analog-clock {
            width: 6vh;
            height: 6vh;
            border: 0.3vh solid #C4682D;
            border-radius: 50%;
            position: relative;
            align-self: center;
            transition: background 0.5s ease, box-shadow 0.5s ease;
        }

        /* Dark Theme: Night Time (18:00 - 06:00) */
        .analog-clock.dark-theme {
            background: rgba(0, 29, 86, 0.8);
            box-shadow: 0 0 1vh rgba(196, 104, 45, 0.3);
        }

        .analog-clock.dark-theme .clock-hand {
            background: #fff;
        }

        .analog-clock.dark-theme .hour-hand {
            background: #fff;
        }

        .analog-clock.dark-theme .minute-hand {
            background: #ccc;
        }

        .analog-clock.dark-theme .second-hand {
            background: #C4682D;
        }

        /* Light Theme: Day Time (06:00 - 18:00) */
        .analog-clock.light-theme {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 0 1.5vh rgba(196, 104, 45, 0.5);
        }

        .analog-clock.light-theme .clock-hand {
            background: #001D56;
        }

        .analog-clock.light-theme .hour-hand {
            background: #001D56;
        }

        .analog-clock.light-theme .minute-hand {
            background: #003D86;
        }

        .analog-clock.light-theme .second-hand {
            background: #C4682D;
        }

        .analog-clock.light-theme .clock-center {
            background: #C4682D;
        }

        .clock-center {
            width: 0.6vh;
            height: 0.6vh;
            background: #C4682D;
            border-radius: 50%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .clock-hand {
            position: absolute;
            bottom: 50%;
            left: 50%;
            transform-origin: bottom center;
            border-radius: 0.25vh 0.25vh 0 0;
            transition: background 0.5s ease;
        }

        .hour-hand {
            width: 0.3vh;
            height: 1.8vh;
            background: #fff;
            margin-left: -0.15vh;
        }

        .minute-hand {
            width: 0.25vh;
            height: 2.5vh;
            background: #ccc;
            margin-left: -0.125vh;
        }

        .second-hand {
            width: 0.2vh;
            height: 2.7vh;
            background: #C4682D;
            margin-left: -0.1vh;
        }

        /* Middle Zone (79vh) - Video Player */
        .video-zone {
            position: relative;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            height: 79vh;
            box-sizing: border-box;
        }

        .video-player {
            width: 100%;
            height: 100%;
            object-fit: cover;
            background: #000;
        }

        .video-hidden {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            pointer-events: none;
        }

        /* Interactive Overlay CTA */
        .cta-overlay {
            position: absolute;
            left: 50%;
            bottom: 5vh;
            right: auto;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #C4682D 0%, #E07935 100%);
            color: #fff;
            padding: 2vh 4vh;
            border-radius: 5vh;
            font-size: 2.5vh;
            font-weight: 700;
            cursor: pointer;
            box-shadow: 0 1vh 3vh rgba(0, 0, 0, 0.5);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            z-index: 100;
        }

        .cta-overlay:hover {
            transform: translateX(-50%) translateY(-0.5vh) scale(1.05);
            box-shadow: 0 1.5vh 4vh rgba(196, 104, 45, 0.6);
        }

        /* Bottom Bar (7vh) - News Ticker */
        .bottom-bar {
            background: #001D56;
            border-top: 0.5vh solid #C4682D;
            display: flex;
            align-items: center;
            overflow: hidden;
            position: relative;
            height: 7vh;
            box-sizing: border-box;
        }

        .news-ticker {
            display: flex;
            white-space: nowrap;
            animation: scroll-left 218s linear infinite;
        }

        .news-item {
            font-size: 2.2vh;
            padding: 0 5vh;
            color: #fff;
        }

        .news-separator {
            color: #C4682D;
            margin: 0 2vh;
        }

        @keyframes scroll-left {
            0% {
                transform: translateX(100%);
            }
            100% {
                transform: translateX(-100%);
            }
        }

        /* Loading Spinner */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3vh;
            color: #C4682D;
            z-index: 1000;
        }

        .spinner {
            border: 0.8vh solid rgba(255, 255, 255, 0.1);
            border-top: 0.8vh solid #C4682D;
            border-radius: 50%;
            width: 8vh;
            height: 8vh;
            animation: spin 1s linear infinite;
            margin: 0 auto 2vh;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Ensure 9:16 vertical aspect ratio on all devices */
        @media (aspect-ratio > 9/16) {
            /* Screen is wider than 9:16 (landscape) - constrain by height */
            .signage-container {
                width: 56.25vh;
                height: 100vh;
            }
        }

        @media (aspect-ratio < 9/16) {
            /* Screen is narrower than 9:16 (ultra-portrait) - constrain by width */
            .signage-container {
                width: 100vw;
                height: 177.78vw;
            }
        }

        @media (aspect-ratio: 9/16) {
            /* Perfect 9:16 vertical screen - use full viewport */
            .signage-container {
                width: 100vw;
                height: 100vh;
            }
        }
    </style>
</head>
<body>
    <div class="aspect-ratio-container">
        <div class="signage-container">
        <!-- Top Bar (14%) -->
        <div class="top-bar">
            <div class="location-info">
                <div class="city-name">BANGKOK</div>
                <div class="time-weather-row">
                    <div class="local-time" id="localTime">00:00:00</div>
                    <div class="weather-info">
                        <span class="weather-icon" id="weatherIcon">â›…</span>
                        <span class="weather-temp" id="weatherTemp">--Â°C</span>
                    </div>
                </div>
                <div class="local-date" id="localDate">Loading...</div>
            </div>

            <div class="world-clocks">
                <div class="clock-wrapper">
                    <div class="clock-city" id="city1">Singapore</div>
                    <div class="analog-clock" id="clock1">
                        <div class="clock-hand hour-hand" id="hour1"></div>
                        <div class="clock-hand minute-hand" id="minute1"></div>
                        <div class="clock-hand second-hand" id="second1"></div>
                        <div class="clock-center"></div>
                    </div>
                </div>
                <div class="clock-wrapper">
                    <div class="clock-city" id="city2">Hong Kong</div>
                    <div class="analog-clock" id="clock2">
                        <div class="clock-hand hour-hand" id="hour2"></div>
                        <div class="clock-hand minute-hand" id="minute2"></div>
                        <div class="clock-hand second-hand" id="second2"></div>
                        <div class="clock-center"></div>
                    </div>
                </div>
                <div class="clock-wrapper">
                    <div class="clock-city" id="city3">Tokyo</div>
                    <div class="analog-clock" id="clock3">
                        <div class="clock-hand hour-hand" id="hour3"></div>
                        <div class="clock-hand minute-hand" id="minute3"></div>
                        <div class="clock-hand second-hand" id="second3"></div>
                        <div class="clock-center"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Middle Zone (79%) - Video Player -->
        <div class="video-zone">
            <video class="video-player" id="mainVideo" autoplay muted playsinline></video>
            <video class="video-player video-hidden" id="preloadVideo" preload="auto" muted playsinline></video>
            <div class="cta-overlay" id="ctaButton">Tap to Explore</div>
        </div>

        <!-- Bottom Bar (7%) - News Ticker -->
        <div class="bottom-bar">
            <div class="news-ticker" id="newsTicker">
                <span class="news-item">Loading news...</span>
            </div>
        </div>
    </div>
    </div>

    <script>
        // ========================================
        // CONFIGURATION
        // ========================================
        /**
         * API Configuration for Digital Signage
         *
         * OPENWEATHERMAP API:
         * - Sign up at: https://openweathermap.org/api
         * - Replace 'YOUR_OPENWEATHERMAP_API_KEY' with your actual API key
         * - Free tier: 60 calls/minute, 1,000,000 calls/month
         * - Endpoint: /weather (Current weather data)
         * - Parameters: lat, lon, units=metric, appid
         *
         * NEWSDATA.IO API:
         * - Sign up at: https://newsdata.io/
         * - Replace 'YOUR_NEWSDATA_IO_API_KEY' with your actual API key
         * - Free tier: 200 requests/day
         * - Endpoint: /api/1/news
         * - Parameters: country=th, language=th,en (bilingual support)
         *
         * CACHING STRATEGY:
         * - Both APIs cache data in localStorage for 1 hour (3600000ms)
         * - On page load, cached data is rendered immediately
         * - New data is fetched only if cache is expired or missing
         * - If API fetch fails, stale cache is displayed with console warning
         */
        const CONFIG = {
            WEATHER_API_KEY: '7c215a78c991666a91e771892ee2aaba',  // OpenWeatherMap API key
            NEWS_API_KEY: 'pub_01dc3f585ecf4d3c8a65986f0025f6d4',  // NewsData.io API key
            BANGKOK_LAT: 13.7563,
            BANGKOK_LON: 100.5018,
            CACHE_DURATION: 3600000,      // 1 hour (3600000ms) - Strict rate limiting
            CTA_LANG_INTERVAL: 3000,      // 3 seconds - CTA language toggle
            CITY_ROTATION_INTERVAL: 8000  // 8 seconds - World clock city rotation
        };

        // City Groups with Timezones
        const CITY_GROUPS = [
            [
                { name: 'Singapore', tz: 'Asia/Singapore' },
                { name: 'Hong Kong', tz: 'Asia/Hong_Kong' },
                { name: 'Tokyo', tz: 'Asia/Tokyo' }
            ],
            [
                { name: 'New York', tz: 'America/New_York' },
                { name: 'Los Angeles', tz: 'America/Los_Angeles' },
                { name: 'Seattle', tz: 'America/Los_Angeles' }
            ],
            [
                { name: 'London', tz: 'Europe/London' },
                { name: 'Paris', tz: 'Europe/Paris' },
                { name: 'Milan', tz: 'Europe/Rome' }
            ]
        ];

        let currentGroupIndex = 0;

        // Playlist Data (Default)
        let playlist = [
            {
                "url": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
                "cta_en": "Explore More",
                "cta_th": "à¸ªà¸³à¸£à¸§à¸ˆà¹€à¸žà¸´à¹ˆà¸¡à¹€à¸•à¸´à¸¡"
            },
            {
                "url": "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
                "cta_en": "Discover Now",
                "cta_th": "à¸„à¹‰à¸™à¸žà¸šà¸•à¸­à¸™à¸™à¸µà¹‰"
            }
        ];

        let currentVideoIndex = 0;
        let ctaLanguage = 'en'; // Toggle between 'en' and 'th'

        // ========================================
        // TIME & CLOCKS
        // ========================================
        function updateBangkokTime() {
            const now = new Date();
            const bangkokTime = now.toLocaleTimeString('en-GB', { timeZone: 'Asia/Bangkok', hour12: false });
            const bangkokDate = now.toLocaleDateString('en-GB', {
                timeZone: 'Asia/Bangkok',
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            document.getElementById('localTime').textContent = bangkokTime;
            document.getElementById('localDate').textContent = bangkokDate;
        }

        function updateAnalogClock(clockIndex, timezone) {
            const now = new Date();
            const timeString = now.toLocaleTimeString('en-US', { timeZone: timezone, hour12: false });
            const [hours, minutes, seconds] = timeString.split(':').map(Number);

            const secondDeg = (seconds * 6); // 360/60
            const minuteDeg = (minutes * 6) + (seconds * 0.1); // 360/60 + smooth transition
            const hourDeg = ((hours % 12) * 30) + (minutes * 0.5); // 360/12 + smooth transition

            // Update clock hands
            document.getElementById(`hour${clockIndex}`).style.transform = `rotate(${hourDeg}deg)`;
            document.getElementById(`minute${clockIndex}`).style.transform = `rotate(${minuteDeg}deg)`;
            document.getElementById(`second${clockIndex}`).style.transform = `rotate(${secondDeg}deg)`;

            // Apply theme based on local time (06:00 - 18:00 = Light Theme, else = Dark Theme)
            const clockElement = document.getElementById(`clock${clockIndex}`);
            if (hours >= 6 && hours < 18) {
                // Day time (06:00 - 18:00): Light theme (White background, Dark hands)
                clockElement.classList.remove('dark-theme');
                clockElement.classList.add('light-theme');
            } else {
                // Night time (18:00 - 06:00): Dark theme (Dark background, White hands)
                clockElement.classList.remove('light-theme');
                clockElement.classList.add('dark-theme');
            }
        }

        function updateWorldClocks() {
            const currentCities = CITY_GROUPS[currentGroupIndex];
            currentCities.forEach((city, index) => {
                const clockIndex = index + 1;
                document.getElementById(`city${clockIndex}`).textContent = city.name;
                updateAnalogClock(clockIndex, city.tz);
            });
        }

        function rotateClockGroup() {
            currentGroupIndex = (currentGroupIndex + 1) % CITY_GROUPS.length;
            updateWorldClocks();
        }

        // ========================================
        // WEATHER API - OpenWeatherMap Integration
        // ========================================
        async function fetchWeather() {
            const cacheKey = 'weather_data';
            const cacheTimeKey = 'weather_timestamp';
            const now = Date.now();

            // Step 1: Check localStorage cache first
            const cachedData = localStorage.getItem(cacheKey);
            const cachedTime = localStorage.getItem(cacheTimeKey);

            // If valid cached data exists, render it immediately
            if (cachedData && cachedTime && (now - parseInt(cachedTime)) < CONFIG.CACHE_DURATION) {
                try {
                    const data = JSON.parse(cachedData);
                    updateWeatherUI(data);
                    console.log('Weather: Using cached data');
                    return;
                } catch (parseError) {
                    console.error('Weather cache parse error:', parseError);
                    // Continue to fetch new data if cache is corrupted
                }
            }

            // Step 2: Fetch new data from OpenWeatherMap API
            try {
                const url = `https://api.openweathermap.org/data/2.5/weather?lat=${CONFIG.BANGKOK_LAT}&lon=${CONFIG.BANGKOK_LON}&appid=${CONFIG.WEATHER_API_KEY}&units=metric`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Validate response data
                if (data.main && data.main.temp && data.weather && data.weather[0]) {
                    // Step 3: Cache the new data
                    localStorage.setItem(cacheKey, JSON.stringify(data));
                    localStorage.setItem(cacheTimeKey, now.toString());

                    // Step 4: Update UI
                    updateWeatherUI(data);
                    console.log('Weather: Fetched new data');
                } else {
                    throw new Error('Invalid weather data structure');
                }
            } catch (error) {
                console.error('Weather fetch error:', error);
                console.warn('Weather API key may not be activated yet. It can take 1-2 hours after signup.');

                // Step 5: Graceful error handling - display cached data if available
                if (cachedData) {
                    try {
                        const data = JSON.parse(cachedData);
                        updateWeatherUI(data);
                        console.log('Weather: Using stale cache due to fetch error');
                    } catch (parseError) {
                        // Use mock data as fallback while API key activates
                        useMockWeatherData();
                    }
                } else {
                    // Use mock data as fallback while API key activates
                    useMockWeatherData();
                }
            }
        }

        function getWeatherIcon(description) {
            // Map weather descriptions to emoji icons
            const desc = description.toLowerCase();

            if (desc.includes('clear')) return 'â˜€ï¸';
            if (desc.includes('cloud') && desc.includes('few')) return 'ðŸŒ¤ï¸';
            if (desc.includes('cloud') && (desc.includes('scattered') || desc.includes('partly'))) return 'â›…';
            if (desc.includes('cloud') && desc.includes('broken')) return 'â˜ï¸';
            if (desc.includes('overcast') || desc.includes('cloud')) return 'â˜ï¸';
            if (desc.includes('rain') && desc.includes('light')) return 'ðŸŒ¦ï¸';
            if (desc.includes('rain') || desc.includes('drizzle')) return 'ðŸŒ§ï¸';
            if (desc.includes('thunderstorm') || desc.includes('storm')) return 'â›ˆï¸';
            if (desc.includes('snow')) return 'ðŸŒ¨ï¸';
            if (desc.includes('mist') || desc.includes('fog') || desc.includes('haze')) return 'ðŸŒ«ï¸';

            return 'â›…'; // Default icon
        }

        function useMockWeatherData() {
            // Temporary mock data while waiting for OpenWeatherMap API key to activate
            console.log('Weather: Using mock data (API key activating...)');
            document.getElementById('weatherIcon').textContent = 'â›…';
            document.getElementById('weatherTemp').textContent = '32Â°C';
        }

        function updateWeatherUI(data) {
            try {
                // Validate data structure
                if (!data || !data.main || !data.main.temp || !data.weather || !data.weather[0]) {
                    throw new Error('Invalid weather data structure');
                }

                const temp = Math.round(data.main.temp);
                const desc = data.weather[0].description;
                const icon = getWeatherIcon(desc);

                document.getElementById('weatherIcon').textContent = icon;
                document.getElementById('weatherTemp').textContent = `${temp}Â°C`;
                console.log(`Weather: ${desc} (${icon}) ${temp}Â°C`);
            } catch (error) {
                console.error('Weather UI update error:', error);
                console.log('Weather: Falling back to mock data');
                useMockWeatherData();
            }
        }

        function displayWeatherError() {
            document.getElementById('weatherIcon').textContent = 'â“';
            document.getElementById('weatherTemp').textContent = '--Â°C';
        }

        // ========================================
        // NEWS API - NewsData.io Integration
        // ========================================
        async function fetchNews() {
            const cacheKey = 'news_data';
            const cacheTimeKey = 'news_timestamp';
            const now = Date.now();

            // Step 1: Check localStorage cache first
            const cachedData = localStorage.getItem(cacheKey);
            const cachedTime = localStorage.getItem(cacheTimeKey);

            // If valid cached data exists, render it immediately
            if (cachedData && cachedTime && (now - parseInt(cachedTime)) < CONFIG.CACHE_DURATION) {
                try {
                    const data = JSON.parse(cachedData);
                    updateNewsUI(data);
                    console.log('News: Using cached data');
                    return;
                } catch (parseError) {
                    console.error('News cache parse error:', parseError);
                    // Continue to fetch new data if cache is corrupted
                }
            }

            // Step 2: Fetch new data from NewsData.io API
            // NOTE: NewsData.io has CORS restrictions - API calls from browser may be blocked
            // Using mock data as fallback for client-side demo
            try {
                // Request both Thai and English languages for bilingual ticker
                const url = `https://newsdata.io/api/1/news?apikey=${CONFIG.NEWS_API_KEY}&country=th&language=th,en`;
                const response = await fetch(url);

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Validate response data
                if (data.results && Array.isArray(data.results)) {
                    // Step 3: Cache the new data
                    localStorage.setItem(cacheKey, JSON.stringify(data));
                    localStorage.setItem(cacheTimeKey, now.toString());

                    // Step 4: Update UI
                    updateNewsUI(data);
                    console.log('News: Fetched new data');
                } else {
                    throw new Error('Invalid news data structure');
                }
            } catch (error) {
                console.error('News fetch error:', error);
                console.warn('NewsData.io API blocked by CORS - using mock data for demo');

                // Step 5: Graceful error handling - display cached data if available
                if (cachedData) {
                    try {
                        const data = JSON.parse(cachedData);
                        updateNewsUI(data);
                        console.log('News: Using stale cache due to fetch error');
                    } catch (parseError) {
                        console.log('News: Cache parse failed, using mock data');
                        useMockNewsData();
                    }
                } else {
                    console.log('News: No cache available, using mock data');
                    useMockNewsData();
                }
            }
        }

        function updateNewsUI(data) {
            try {
                // Validate data structure
                if (!data || !data.results || !Array.isArray(data.results) || data.results.length === 0) {
                    throw new Error('Invalid news data structure or no results');
                }

                // Format headlines for seamless horizontal scrolling
                const newsHTML = data.results
                    .map(article => {
                        if (!article || !article.title) return '';
                        // Sanitize title to prevent XSS
                        const title = article.title.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        return `<span class="news-item">${title}</span><span class="news-separator">â€¢</span>`;
                    })
                    .filter(html => html !== '')
                    .join('');

                // Duplicate content for seamless infinite loop
                const tickerElement = document.getElementById('newsTicker');
                tickerElement.innerHTML = newsHTML + newsHTML;
                console.log('News: UI updated successfully');
            } catch (error) {
                console.error('News UI update error:', error);
                console.log('News: Falling back to mock data');
                useMockNewsData();
            }
        }

        function useMockNewsData() {
            // Temporary mock data for news ticker
            console.log('News: Using mock data (testing fallback)');
            const mockNews = [
                'Thailand economic growth expected to accelerate in 2026',
                'à¸›à¸£à¸°à¹€à¸—à¸¨à¹„à¸—à¸¢à¹€à¸•à¸£à¸µà¸¢à¸¡à¸žà¸£à¹‰à¸­à¸¡à¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸™à¸±à¸à¸—à¹ˆà¸­à¸‡à¹€à¸—à¸µà¹ˆà¸¢à¸§à¹ƒà¸™à¸Šà¹ˆà¸§à¸‡à¹€à¸—à¸¨à¸à¸²à¸¥',
                'Digital transformation continues to reshape Thai businesses',
                'à¸à¸£à¸¸à¸‡à¹€à¸—à¸žà¸¯ à¸•à¸´à¸”à¸­à¸±à¸™à¸”à¸±à¸šà¹€à¸¡à¸·à¸­à¸‡à¸—à¸µà¹ˆà¸™à¹ˆà¸²à¹€à¸—à¸µà¹ˆà¸¢à¸§à¸Šà¸¡à¸—à¸µà¹ˆà¸ªà¸¸à¸”à¹ƒà¸™à¹‚à¸¥à¸',
                'Thailand leads ASEAN in sustainable tourism initiatives'
            ];
            const newsHTML = mockNews
                .map(title => `<span class="news-item">${title}</span><span class="news-separator">â€¢</span>`)
                .join('');
            const tickerElement = document.getElementById('newsTicker');
            tickerElement.innerHTML = newsHTML + newsHTML;
            console.log('News ticker: Mock headlines displayed');
        }

        function displayNewsError(message = 'News service temporarily unavailable') {
            document.getElementById('newsTicker').innerHTML =
                `<span class="news-item">${message}</span>`;
        }

        // ========================================
        // VIDEO PLAYLIST & PRELOADING
        // ========================================
        async function loadPlaylist() {
            try {
                const response = await fetch('playlist.json');
                const data = await response.json();
                if (data && data.length > 0) {
                    playlist = data;
                }
            } catch (error) {
                console.warn('Could not load playlist.json, using defaults:', error);
            }
        }

        function playVideo() {
            const mainVideo = document.getElementById('mainVideo');
            const preloadVideo = document.getElementById('preloadVideo');
            const currentVideo = playlist[currentVideoIndex];

            // Set main video source
            mainVideo.src = currentVideo.url;
            mainVideo.load();
            mainVideo.play().catch(err => console.error('Play error:', err));

            // Update CTA
            updateCTA();

            // Preload next video
            const nextIndex = (currentVideoIndex + 1) % playlist.length;
            const nextVideo = playlist[nextIndex];
            preloadVideo.src = nextVideo.url;
            preloadVideo.load();

            // Setup event for seamless transition
            mainVideo.onended = () => {
                // Swap videos for gapless playback
                mainVideo.src = preloadVideo.src;
                mainVideo.load();
                mainVideo.play().catch(err => console.error('Play error:', err));

                currentVideoIndex = nextIndex;
                updateCTA();

                // Preload next video
                const newNextIndex = (currentVideoIndex + 1) % playlist.length;
                preloadVideo.src = playlist[newNextIndex].url;
                preloadVideo.load();
            };
        }

        function updateCTA() {
            const ctaButton = document.getElementById('ctaButton');
            const currentVideo = playlist[currentVideoIndex];

            ctaButton.textContent = ctaLanguage === 'en' ? currentVideo.cta_en : currentVideo.cta_th;
        }

        function toggleCTALanguage() {
            ctaLanguage = ctaLanguage === 'en' ? 'th' : 'en';
            updateCTA();
        }

        // ========================================
        // INITIALIZATION
        // ========================================
        async function init() {
            // Clear any corrupted cache from previous tests
            localStorage.removeItem('weather_data');
            localStorage.removeItem('weather_data_time');
            localStorage.removeItem('news_data');
            localStorage.removeItem('news_data_time');

            // Load playlist
            await loadPlaylist();

            // Start video playback
            playVideo();

            // Show mock data immediately (fallback for CORS-blocked APIs)
            useMockWeatherData();
            useMockNewsData();

            // Try to fetch real weather and news (will override mock if successful)
            fetchWeather();
            fetchNews();

            // Update Bangkok time
            updateBangkokTime();
            setInterval(updateBangkokTime, 1000);

            // Update world clocks
            updateWorldClocks();
            setInterval(updateWorldClocks, 1000);

            // Rotate clock groups every 8 seconds
            setInterval(rotateClockGroup, CONFIG.CITY_ROTATION_INTERVAL);

            // Toggle CTA language every 3 seconds
            setInterval(toggleCTALanguage, CONFIG.CTA_LANG_INTERVAL);

            // Refresh weather and news every hour
            setInterval(fetchWeather, CONFIG.CACHE_DURATION);
            setInterval(fetchNews, CONFIG.CACHE_DURATION);
        }

        // Start when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }

        // CTA Button Click Handler (Optional)
        document.getElementById('ctaButton').addEventListener('click', () => {
            console.log('CTA clicked:', playlist[currentVideoIndex]);
            // Add your interaction logic here
        });
    </script>
</body>
</html>